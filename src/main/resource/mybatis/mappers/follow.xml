<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="follow">
   
   <!--  1. 팔로우 추가  -->
   <insert id="addFollow" parameterType="map">
      <![CDATA[
         insert into follow( users_no, follow_users_no) 
         values(#{users_no}, #{authUser_no})
      ]]>
   </insert>
   <!--  1.1 팔로우 추가시 USERS 테이블 팔로우 숫자 갱샌해주기 -->
   <update id="followerUpdate" parameterType="int">
         <![CDATA[
            update users 
            set follower_num = (select count(follow_users_no)  from follow where users_no=#{users_no}) 
            where users_no = #{users_no}
         ]]>
   </update>

   <!--  2. 팔로우 삭제 -->   
   <delete id="deleteFollow" parameterType="map">
      <![CDATA[
         delete 
            from follow
         where users_no = #{users_no} and follow_users_no=#{authUser_no}
      ]]>
   </delete>
   
   <!--  3. 해당유저가 팔로잉 중인  리스트 뽑오내기 -->
   <select id="followingList" parameterType="int" resultType="uservo">
      <![CDATA[
         select b.nickname
            from ( select users_no
                     from follow
                  where follow_users_no = #{users_no} ) a ,users b
            where a.users_no = b.users_no
      ]]>
   </select>
   
   <!--  4. 해당 유저를 팔로우하는  리스트 뽑아내기 -->
   <select id="followList" parameterType="int" resultType="uservo">
      <![CDATA[
         select b.nickname
            from ( select users_no
                     from follow
                  where users_no = #{users_no} ) a , users b
            where a.users_no = b.users_no
      ]]>
   </select>
   
   <!--  5. 팔로우 여부 판단을 위해 디비 검색  -->
   <select id="didFollow" parameterType="map" resultType="uservo">
      <![CDATA[
         select users_no
            from follow
            where users_no=#{users_no} and follow_users_no = #{authUser_no}
      ]]>   
   </select>
   
   <!--  6.팔로잉 하는 사람 숫자 -->
   <select id="countFollower" parameterType="int" resultType="int">
      <![CDATA[
         select count(follow_users_no)
            from follow
            where users_no=#{users_no}
      ]]>
   </select>
   
</mapper>